<div class="update-container container mt-4">
  <h2 class="text-center titulo-crear">Mi Perfil</h2>

  <div class="text-center mb-4" *ngIf="usuario && usuario.image">
    <img [src]="imagePreview || getImageUrl(usuario.image)" alt="Imagen de perfil"
         class="profile-avatar img-fluid" />
  </div>

  <div *ngIf="mensaje" class="alert alert-success">{{ mensaje }}</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="loading" class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Cargando...</span>
  </div>

  <div *ngIf="!usuario || !usuario.username" class="alert alert-warning">
    No se han cargado datos del usuario. Por favor, inicia sesión primero.
  </div>

  <form *ngIf="usuario && usuario.username" class="card p-4 mt-3" (ngSubmit)="updateUsuario()">
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Username:</label>
        <input type="text" class="form-control" [(ngModel)]="usuario.username" name="username" readonly />
      </div>
      <div class="col-md-6">
        <label class="form-label">Nueva contraseña (opcional):</label>
        <input type="password" class="form-control" [(ngModel)]="nuevaPassword" name="password"
          placeholder="Nueva contraseña"
          pattern="^(?=.*[A-Z])(?=.*[a-z])(?=.*\\d)(?=.*[@$!%*?&.])[A-Za-z\\d@$!%*?&.]{8,}$"
          title="La contraseña debe tener al menos 8 caracteres, una mayúscula, una minúscula, un número y un símbolo." />
      </div>
    </div>

 <div class="row mb-3">
  <div class="col-md-12">
    <label class="form-label">Previsualización:</label><br />
    <img [src]="imagePreview || getImageUrl(usuario.image)" alt="Imagen" class="img-thumbnail" width="350" />
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-12">
    <label class="form-label">Subir nueva imagen:</label>
    <input type="file" class="form-control" (change)="uploadImage($event)" accept="image/*" />
  </div>
</div>

    <div class="text-center mt-3">
      <button type="submit" class="btn btn-success" [disabled]="loading || !userToken">Actualizar</button>
    </div>
  </form>
</div>

